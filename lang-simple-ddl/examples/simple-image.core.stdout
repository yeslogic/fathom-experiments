format u16le :=
  let b0 <- byte;
  let b1 <- byte;
  #pure #Int (#int64-logical-or b0 (#int64-logical-shl b1 8));

format u8 := byte;

format u16be :=
  let b0 <- byte;
  let b1 <- byte;
  #pure #Int (#int64-logical-or (#int64-logical-shl b0 8) b1);

type Pixel {
  blue : #Int;
  green : #Int;
  red : #Int;
}

format pixel :=
  let red <- u8;
  let green <- u8;
  let blue <- u8;
  #pure Pixel (Pixel { blue := blue; green := green; red := red });

type Info {
  height : #Int;
  width : #Int;
}

format info :=
  let width <- u16be;
  let height <- u16be;
  #pure Info (Info { height := height; width := width });

type Image {
  data : #List Pixel;
  info : Info;
}

format image :=
  let info <- info;
  let num-pixels <- #pure #Int (#int64-mul info.width info.height);
  let data <- #repeat-len num-pixels pixel;
  #pure Image (Image { data := data; info := info });
